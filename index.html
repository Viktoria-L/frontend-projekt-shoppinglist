<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mina listor</title>
    <link rel="stylesheet" href="css/default.css">
    <link rel="stylesheet" href="css/pages/index.css">
    <link rel="stylesheet" href="css/default.css">
    <link rel="stylesheet" href="css/variables.css">
    <link rel="stylesheet" href="style.css">
    <script src="main.js" type="module" defer></script>
</head>
<body>
    <header>
        <div class="headerLogoSettings">
            <img src="assets/logo.svg" alt="">
            <a href=""><img src="assets/gear.svg" alt=""></a>
        </div>
        <div class="headerNameEdit">
            <h1>My shopping list</h1>
            <button id="editBtn"><img src="assets/three-dots-vertical.svg" alt=""></button>
        </div>
        <hr>
    </header>

    <main>
		<content class="item-container" id="list-output"></content>
        <div id="output-status" class="call-to-action">
            <h3>Du verkar inte ha några listor att visa.<br> Skapa en genom att klicka på plus-symbolen</h3>
        </div>
		<div id="current-content">
            <div class="addAnItemDiv"></div>
            <ul id="listItems"></ul>
            <div class="saveToApi"></div>
        </div>
        <button id="newListBtn">+</button>
		<!--
		ITEM STRUCTURE
		<div>
			<h2>List title</h2>
            <button>Delete list</button>
			<ul>
				<li>
					<input type="checkbox">
					<input type="text">
				</li>
				...
			</ul>
		</div>
		-->	
    	<script type="text/javascript">
    		const statusElement = document.querySelector('#output-status');
    		const outputElement = document.querySelector('#list-output');
    		let result = '';

			function display(outputArray) {
				console.log(outputArray);
				const isEmpty = outputArray.length === 0
				statusElement.style = 'display: ' + (isEmpty && 'block' || 'none')
				// statusElement.innerHTML = isEmpty && 'No lists available!' || ''

				for (let i = 0; i < outputArray.length; i++) {
					let list = outputArray[i];
					let listName = list.listname || '???'
					let children = list.itemList

					let isNotArray = !Array.isArray(children)
					if (isNotArray) {continue;}

					result += `
					<div id="${list._id}">
						<h2 class="list-title">${listName}</h2>
                        <button class="iconspans remove hidden"><img src="assets/trash.svg" alt=""></button>
						<ul>
					`
					children.forEach((item) => {
						let checkedText = item.checked && 'checked' || ''
						let itemName = item.title || '???'

						result += `
							<li>
								<input type="checkbox" ${checkedText}>
								<input type="text" value="${itemName}">
							</li>
						`
					})

					result += `
						</ul>
					</div>
					`
				}
				console.log(outputElement);
				outputElement.innerHTML = result;
				//json = JSON.stringify(outputObj);
				//output.innerHTML = json;
			}

			// statusElement.innerHTML = 'Loading lists...';

			const API_BASE = 'https://nackademin-item-tracker.herokuapp.com';
			const API_FILTER = 'grupp_e';
			// https://nackademin-item-tracker.herokuapp.com/findlistbykey?key=customfield&value=Custom
			fetch(API_BASE + '/findlistbykey?key=customfield&value=' + API_FILTER)
				.then((response) => response.json())
				.then(display);

    	</script>
    </main>
    <footer></footer>
    
</body>
</html>